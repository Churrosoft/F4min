[env:black_f407vg]
platform        = ststm32
board           = black_f407vg
framework       = stm32cube
extra_scripts   = pre:extra_script.py
debug_speed     = 3000
test_build_src = yes 

platform_packages =
    platformio/tool-qemu-riscv
test_testing_command =
   ${platformio.build_dir}/../../launch_qemu.sh

;    exec timeout 25s
;    xpack-qemu-arm-2.8.0-11/bin/qemu-system-gnuarmeclipse \
;    --verbose
;    --semihosting-config enable=on,target=native
;    -gdb tcp::3333
;    -nographic -M STM32F4-Discovery
;    -no-reboot
;    -kernel ${platformio.build_dir}/${this.__env__}/firmware.bin
    
;    ${platformio.packages_dir}/tool-qemu-riscv/bin/qemu-system-riscv32
;    -nographic
;    -machine
;    sifive_e
;    -kernel
    

; Extra libraries to be linked
lib_deps = 
    Unity
    Semihosting

build_flags = 
    ; Generate linker map in firmware.map and show memory usage.
    -Wl,-Map,firmware.map,--print-memory-usage
    -g
    -O2
    !python pre_script.py

debug_build_flags = 
    -Wl,-Map,firmware.map,--print-memory-usage
    -g
    -02
    !python pre_script.py

build_unflags =
    --specs=nosys.specs 
    -lnosys
    -Os

debug_port      = /dev/ttyACM0
upload_port     = /dev/ttyACM0
debug_tool      = blackmagic
upload_protocol = blackmagic

[platformio]
include_dir = Inc
src_dir = Src
